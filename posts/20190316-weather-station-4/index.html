<!DOCTYPE html>
<html lang="pl">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="pl">

    <meta name="author" content="Licho">
    <meta name="description" content="Wreszcie dotarły do mnie wszystkie elementy układanki i zacząłem składać czujki w zgrabną całość. Jeśli jeszcze raz ktoś mi powie, że rezystory o rozmiarach 0,6 x 0,3mm są fajne do ręcznego lutowania, to mu przylutuję…
Czujnik temperatury Jako podstawy czujki użyłem płytki prototypowej do której przymocowałem wszystkie elementy — Arduino Pro Mini oraz nRF24l01 za pomocą goldpinów które później skróciłem aby całość mogła dość nisko wejść w obudowę. W pobliżu pinu piątego umiejscowiłem DS18b20 oraz rezystor SMD 0603 4k7 podciągający linię sygnałową do stanu wysokiego.">
    <meta name="keywords" content="blog,sysadmin,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Własna stacja pogodowa — część czwarta i ostatnia"/>
<meta name="twitter:description" content="Wreszcie dotarły do mnie wszystkie elementy układanki i zacząłem składać czujki w zgrabną całość. Jeśli jeszcze raz ktoś mi powie, że rezystory o rozmiarach 0,6 x 0,3mm są fajne do ręcznego lutowania, to mu przylutuję…
Czujnik temperatury Jako podstawy czujki użyłem płytki prototypowej do której przymocowałem wszystkie elementy — Arduino Pro Mini oraz nRF24l01 za pomocą goldpinów które później skróciłem aby całość mogła dość nisko wejść w obudowę. W pobliżu pinu piątego umiejscowiłem DS18b20 oraz rezystor SMD 0603 4k7 podciągający linię sygnałową do stanu wysokiego."/>

    <meta property="og:title" content="Własna stacja pogodowa — część czwarta i ostatnia" />
<meta property="og:description" content="Wreszcie dotarły do mnie wszystkie elementy układanki i zacząłem składać czujki w zgrabną całość. Jeśli jeszcze raz ktoś mi powie, że rezystory o rozmiarach 0,6 x 0,3mm są fajne do ręcznego lutowania, to mu przylutuję…
Czujnik temperatury Jako podstawy czujki użyłem płytki prototypowej do której przymocowałem wszystkie elementy — Arduino Pro Mini oraz nRF24l01 za pomocą goldpinów które później skróciłem aby całość mogła dość nisko wejść w obudowę. W pobliżu pinu piątego umiejscowiłem DS18b20 oraz rezystor SMD 0603 4k7 podciągający linię sygnałową do stanu wysokiego." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://brainfork.org/posts/20190316-weather-station-4/" />
<meta property="article:published_time" content="2019-03-16T00:00:00+02:00" />
<meta property="article:modified_time" content="2019-03-16T00:00:00+02:00" />


    <title>
  Własna stacja pogodowa — część czwarta i ostatnia · Brainfork
</title>

    
      <link rel="canonical" href="https://brainfork.org/posts/20190316-weather-station-4/">
    

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css"
      integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8/normalize.min.css">
    
      
      
      <link rel="stylesheet" href="/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css" integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz&#43;OMl98=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.80.0" />
  </head>

  
  
  <body class="colorscheme-light"
        onload=""
  >
    

    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Brainfork
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">/</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/programowanie/">Programowanie</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/elektronika/">Elektronika</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/sysadmin/">Linux/FreeBSD</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/diy/">DIY</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/hardware/">Hardware</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/felietony/">Felietony</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Własna stacja pogodowa — część czwarta i ostatnia</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2019-03-16T00:00:00&#43;02:00'>
                March 16, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              3 min czytania
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/categories/elektronika/">Elektronika</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <a href="/tags/atmel/">atmel</a>
      <span class="separator">•</span>
    <a href="/tags/atmega/">atmega</a>
      <span class="separator">•</span>
    <a href="/tags/avr/">avr</a>
      <span class="separator">•</span>
    <a href="/tags/arduino/">arduino</a>
      <span class="separator">•</span>
    <a href="/tags/pogoda/">pogoda</a></div>

        </div>
      </header>

      <div>
        
        <p>Wreszcie dotarły do mnie wszystkie elementy układanki i zacząłem składać czujki
w zgrabną całość. Jeśli jeszcze raz ktoś mi powie, że rezystory o rozmiarach
0,6 x 0,3mm są fajne do ręcznego lutowania, to mu przylutuję…</p>
<h2 id="czujnik-temperatury">Czujnik temperatury</h2>
<p>Jako podstawy czujki użyłem płytki prototypowej do której przymocowałem
wszystkie elementy — Arduino Pro Mini oraz nRF24l01 za pomocą goldpinów które
później skróciłem aby całość mogła dość nisko wejść w obudowę. W pobliżu pinu
piątego umiejscowiłem DS18b20 oraz rezystor SMD 0603 4k7 podciągający linię
sygnałową do stanu wysokiego. Pod modułem radiowym umiejscowiłem dzielnik
napięcia na dwóch rezystorach (47k i 15k) który służy do pomiaru stanu
naładowania akumulatora, a moduł ładowania akumulatora przymocowałem klejem
cyjanoakrylowym (“kropelka”). Akumulator oraz sama płytka zostały na końcu
zamocowane do obudowy klejem na gorąco z uwagi na ograniczoną przestrzeń i
możliwości montażowe. Kod używa bibliotek <em>RF24</em> oraz <em>RF24Network</em> do
komunikacji z modułem radiowym, a także <em>OneWire</em> i <em>DallasTemperature</em> do
obsługi DS18b20. W przypadku liczby czujników przekraczającej 5 urządzeń warto
byłoby dodać bibliotekę <em>RF24Mesh</em> w celu automatyzacji konfiguracji bardziej
złożonej sieci.</p>
<figure>
    <img src="/assets/weather-station/node-1.jpg"
         alt="Gotowa czujka w obudowie."/> <figcaption>
            <p>Gotowa czujka w obudowie.</p>
        </figcaption>
</figure>

<figure>
    <img src="/assets/weather-station/node-2.jpg"
         alt="A tak wygląda całość po zamknięciu obudowy. Z zewnątrz dostępny jest jedynie port USB do ładowania"/> <figcaption>
            <p>A tak wygląda całość po zamknięciu obudowy. Z zewnątrz dostępny jest jedynie port USB do ładowania</p>
        </figcaption>
</figure>

<h2 id="stacja-bazowa">Stacja bazowa</h2>
<p>Stacja bazowa została zgodnie z planem oparta o Raspberry Pi Zero W oraz
nRF24l01. Raspberry pomimo ograniczonych zasobów sprawnie operuje jako serwer
PostgreSQL w którym logowane są dane, natomiast nie zdecydowałem się instalować
na nim samej Grafany, w obawie o dostępną ilość pamięci RAM.</p>
<figure>
    <img src="/assets/weather-station/rpi-1.jpg"
         alt="Raspberry Pi Zero W"/> <figcaption>
            <p>Raspberry Pi Zero W</p>
        </figcaption>
</figure>

<p>Samo oprogramowanie zbierające dane zostało napisane w C++ z użyciem tych
samych bibliotek które wykorzystywane są w czujnikach, oraz <em>libpqxx</em> w celu
komunikacji z bazą danych. Całość pracuje pod Raspbianem, choć chętnie
wymieniłbym go na FreeBSD lub Alpine Linux, to pierwszy nie wspiera wbudowanego
chipsetu Wi-Fi tworząc cały projekt bezużytecznym, z drugim zaś mam problemy z
kompatybilnością ze sprzętem.</p>
<figure>
    <img src="/assets/weather-station/rpi-2.jpg"
         alt="Profesjonalnie zainstalowany mod, brakuje tylko kleju na gorąco…"/> <figcaption>
            <p>Profesjonalnie zainstalowany mod, brakuje tylko kleju na gorąco…</p>
        </figcaption>
</figure>

<p>Moduł radiowy został przylutowany do sprzętowego interfejsu SPI i jest na tyle
mały, że bez problemu mieści się w standardowej obudowie dla RPi Zero.</p>
<figure>
    <img src="/assets/weather-station/rpi-3.png"
         alt="Pisałem przecież, że profesjonalnie…"/> <figcaption>
            <p>Pisałem przecież, że profesjonalnie…</p>
        </figcaption>
</figure>

<h2 id="wnioski">Wnioski</h2>
<p>Na tym modelu układu radiowego zasięg w domu ograniczył się do 15 metrów, choć
warto mieć na uwadze strop pomiędzy piętrami który znacznie pogarsza jakość
wszelkiej komunikacji radiowej. Prawdopodobnie układy ze złączem na typową
antenę 2,4GHz posiadałyby lepsze parametry, ale także znacznie wpłynęły na
koszt całości. Porzucenie pomysłu z użyciem Wi-Fi uważam za dobrą decyzję,
nawet kosztem zasięgu.</p>
<p>Z rzeczy które zrobiłbym inaczej wymienię brak układu który pozwalałby na
odcięcie zasilania od całości w przypadku niskiego poziomu naładowania
akumulatora, a także użycie dzielnika napięcia o większej rezystancji, co
zmniejszyłoby pobór prądu. Zarządzanie kablami na płytce prototypowej też nie
powala, a zamiast przewodów z taśmy (takiej jak używana do montażu starych
dysków na PATA) użyłbym przewodów ze skrętki UTP — lepiej zapamiętują kształt i
posiadają więcej kolorów niż szary.</p>
<p>Niemniej, jestem zadowolony z wyników swojej pracy, a szacowany czas działania
czujnika na jednym ładowaniu wynosi około 20 dni przy założeniu, że aktywna
komunikacja radiowa jest prowadzona co 5 minut.</p>
<figure>
    <img src="/assets/weather-station/grafana-2.png"
         alt="Finalna wersja panelu z podłączonym jednym czujnikiem."/> <figcaption>
            <p>Finalna wersja panelu z podłączonym jednym czujnikiem.</p>
        </figcaption>
</figure>

<p>Na powyższym zrzucie przedstawiony jest pierwszy, testowy czujnik.
Częstotliwość komunikacji została zwiększona do 30 sekund, co znacznie wpływa
na żywotność akumulatora. Ponadto pierwsze próbki zostały przechwycone z
podłączoną ładowarką, co widocznie przekłamuje widoczny stan naładowania, a
także prawdopodobnie wpłynęło na odczyty temperatury.</p>
<h2 id="aktualizacja-13042019">Aktualizacja (13.04.2019)</h2>
<p>Po poprawkach w kodzie, z których najważniejszymi były dodanie usypiania
zarówno dla mikrokontrolera, jak i radia, a także zmniejszeniu częstotliwości
pomiarów do 5 minut czas działania na jednym ładowaniu zwiększył się do
niecałych 3 miesięcy, nawet pomimo zwiększonego ograniczenia rozładowania
akumulatora. Zmiana ograniczenia wpłynie pozytywnie na żywotność samego ogniwa.</p>
<h2 id="poprzednie-artykuły-z-serii">Poprzednie artykuły z serii</h2>
<ol>
<li><a href="/posts/20180228-weather-station/">Początki z Arduino, czyli własna stacja pogodowa</a></li>
<li><a href="/posts/20180304-weather-station-2/">Własna stacja pogodowa — changelog</a></li>
<li><a href="/posts/20190216-weather-station-3/">Własna stacja pogodowa - część trzecia</a></li>
</ol>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
        2021
         Licho 
      
      
      
    </section>
  </footer>


    </main>

    

    

    

    

    

    

    
<script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "32ff9bc2c98a4d00a4753bc9eb21f60b"}'></script>


  </body>

</html>
